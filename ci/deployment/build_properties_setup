#!/bin/bash

echo "$GOOGLE_API_KEY_JSON" >google_api_key.json

# Get the branch name after the last '/'. ex release/2020.4.0 = 2020.4.0
var_branchSuffix=$(echo "$BITBUCKET_BRANCH" | sed 's:.*/::')

cat << EOF >> build-logic/build_properties.gradle.kts
extra.apply {
    set("VERSION_CODE", ${BITBUCKET_BUILD_NUMBER})
    set("VERSION_NAME", "${var_branchSuffix}")
    set("VERSION_SUFFIX", "${BITBUCKET_DEPLOYMENT_ENVIRONMENT}")
    set("DEBUGGABLE", ${BUILD_IS_DEBUGGABLE:-false})
    set("DB_ENCRYPTION", ${DB_IS_ENCRYPTED:-true})
}
EOF
